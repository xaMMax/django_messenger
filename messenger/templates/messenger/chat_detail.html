<!-- У файлі templates/messenger/chat_detail.html -->

{% extends "base_generic.html" %}
{% load custom_tags %}
{% block messages %}
{#    <h1>History</h1>#}
{% endblock %}

{% block content %}
    <div class="chat_view">
        <div class="chat_name"><h2>{{ chat.name }}</h2></div>
        <div class="chat_body">
            <div class="chat_messages">
                <h3>Messages</h3>
                <ul>
                {% for message in messages %}
                    <li class="messagelist">
                    <small>{{ message.author.username }}:</small>
                    <p>{{ message.message }}</p>
                {% if message.created_at|compare_datas:message.updated_at %}
                    <small style="font-style: italic">edited {{ message.updated_at }}</small>
                {% else %}
                    <small>{{ message.created_at }}</small>
                {% endif %}
                {% if request.user == message.author %}
                    <a href="{% url 'edit_message' message.id %}" style="color: blue">Edit</a>
                    <a href="{% url 'delete_message' message.id %}" style="color: red">Delete</a>
                {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
            <div class="chat_participants">  
                <h3>Chat members</h3>
                <h4>Online Users</h4>
                <ul>
                    {% for user in online_users %}
                        <li class="online-user">
                        <a href="{% url 'user_profile' pk=user.pk %}">{{ user.user.username }}</a>
                        </li>
                    {% endfor %}
                </ul>
            
                <h4>Offline Users</h4>
                <ul>
                    {% for user in offline_users %}
                        <li class="offline-user">
                        <a href="{% url 'user_profile' pk=user.pk %}">{{ user.user.username }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="send_message_div">
            <h3>Send a message</h3>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button class="button" type="submit">Send</button>
            </form>
        </div>
    </div>

    <div class="actions">
        {% if request.user|has_permission:'messenger.can_add_users' %}
            <a href="{% url 'add_user_to_chat' pk=chat.pk %}">Add user to chat</a>
        {% endif %}
        {% if user.is_staff %}
            <a href="{% url 'chat_messages_json' pk=chat.pk %}">To JSON</a>
        {% endif %}
    </div>
{% endblock %}